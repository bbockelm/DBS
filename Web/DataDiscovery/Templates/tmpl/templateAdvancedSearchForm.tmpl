<!-- templateAdvancedSearchForm.tmpl -->

<div align="center">
<form action="aSearch" method="get">
<input type="hidden" name="caseSensitive" value="on" id="caseSensitive" />
<input type="hidden" name="userMode" id="userMode" value="$userMode" />
<input type="hidden" name="sortOrder" id="sortOrder" value="desc" />
<input type="hidden" name="sortName" id="sortName" value="" />
<input type="hidden" name="grid" id="grid" value="0" />

## add table with case sensitivity and choice of dbs instance (in expert mode)
<table cellpadding="2" cellspacing="2">
<tr>
#if $userMode=='user'
<td>
##<input type="hidden" name="dbsInst" value="$dbsInst" id="kw_dbsInstSelector" />
<input type="hidden" name="dbsInst" value="$dbsInst" id="dbsInst" />
</td>
<td>
</td>
#else
<td align="right">
<div id="dbsInstDef">
<b>DBS instances</b>
</div>
</td>
<td>
<select name="dbsInst" id="dbsInst" onchange="javascript:ReloadMethod('$host','_advanced','$userMode')" style="$style">
#for dbs in $dbsList
<option value="$dbs">$dbs</option>
#end for
</select>
</td>
#end if
<td>
Case-sensitivity:
<a href="javascript:CaseSensitiveOn();"><span id="caseOn" class="td_underline_pad">on</span></a> 
| 
<a href="javascript:CaseSensitiveOff();"><span id="caseOff" class="">off</span></a>
</td>
</tr>
</table>

#*
#if len($userInput)
<input type="text" size="80" name="userInput" id="userInput" />
#else
<input type="text" size="80" name="userInput" id="userInput" />
#end if
*#
<input type="text" size="80" name="userInput" id="userInput" />
<input type="submit" value="Search" onclick="javascript:SetTagCookie('DBSDD_ainput','userInput')" />
<input type="reset" />
###<input type="reset" value="Reset" />

</form>

#if $userHelp
<p></p>
<p></p>
##<p>The advanced search engine look-up dataset based on your keyword input.</p>

<table width="65%">
<tr valign="top">
<td align="right">
<b>Syntax:</b>
</td>
<td>
<b>
FIND &lt;keyword&gt; WHERE &lt;keyword&gt; &lt;operator&gt; &lt;value&gt; AND | OR 
&lt;keyword&gt; &lt;operator&gt; &lt;value&gt;
</b>
<br/>
Constrain operators: 
<b>
&lt;=, &lt;, &gt;=, &gt;, =, not like, like, in, between
</b>
<br/>
words FIND,WHERE,AND,OR can be upper or lower case. 
<br/>
<b>FIND path WHERE ...</b> is default and can be skipped.
<br/>
Expressions can be
groupped together using brackets, e.g. ((a and b) or c)
<br/>
<br/>
</td>
</tr>

<tr valign="top">
<td align="right">
<b>Keywords:</b>
</td>
<td>
<b>
<span id="dsetDef">
dataset
</span>
,
<span id="pathDef">
path
</span>
,
<span id="primDef">
primds
</span>
,
<span id="procDef">
procds
</span>
,
<span id="tierDef">
tier
</span>
,
<span id="blkDef">
block
</span>
,
<span id="fileDef">
file
</span>
,
<span id="relDef">
release
</span>
,
<span id="runDef">
run
</span>
,
<span id="lumiDef">
lumi
</span>
,
<span id="seDef">
site.
</span>
</b>
<br/>
Hover over keywords for <span class="box_red">info</span>.
<br/>
<br/>
##You can also use comparison operators, i.e. '==', '&gt;', '&gt;=', '&lt;', '&lt;=' and '!'.
</td>
</tr>

<tr valign="top">
<td align="right">
<b>Examples:</b>
</td>
<td>
<em class="box_blue">
find dataset where path like *Online* and site=srm.cern.ch
</em>
<br/>
look-up datasets with dataset path matched pattern *Online* and located at srm.cern.ch.
<br/><br/>
<em class="box_blue">
find dataset where run between 34850-36000 or run in 34850,34890
</em>
<br/>
look-up dataset with runs within a given run ranges.
<br/><br/>

<em class="box_blue">
find run where path like *Online*
</em>
<br/>
look-up runs who belong to dataset with path pattern *Online* 
<br/><br/>

<em class="box_blue">
find primds where (path like *Online* or path not like *RelVal* ) and release>CMSSW_1_7
</em>
<br/>
look-up primary datasets whose dataset path pattern either Online or not like RelVal which<br/>
are processed with release greater them CMSSW_1_7
<br/><br/>

</td>
</tr>

</table>

<p>
Command line tool for this interface is available <a href="aSearchCLI">here</a>.
</p>
#end if

</div> <!-- end of center -->

<script type="text/javascript">
#if $userHelp
var tooltip;
tooltip="<p>Full qualified dataset path or pattern, e.g. /DaqTest-A/Online/RAW.</p>";
MakeTooltip("t_dset","dsetDef",tooltip);
tooltip="<p>Full qualified dataset path or pattern, synonym to dataset</p>";
MakeTooltip("t_dset","pathDef",tooltip);
tooltip="<p>Full qualified processed dataset name or pattern, e.g. Online.</p>";
MakeTooltip("t_proc","procDef",tooltip);
tooltip="<p>Full qualified primary dataset name or pattern, e.g. DaqTest-A.</p>";
MakeTooltip("t_prim","primDef",tooltip);
tooltip="<p>Full qualified data tier name or pattern, e.g. RAW.</p>";
MakeTooltip("t_tier","tierDef",tooltip);
tooltip="<p>Block name, including block UID.</p>";
MakeTooltip("t_","blkDef",tooltip);
tooltip="<p>LFN name or pattern </p>";
MakeTooltip("t_","fileDef",tooltip);
tooltip="<p>Release version/name, e.g. CMSSW_1_7*.</p>";
MakeTooltip("t_","relDef",tooltip);
tooltip="<p>Run number or run range, e.g. 34850-34860.</p>";
MakeTooltip("t_","runDef",tooltip);
tooltip="<p>Lumi section number or range of lumi section numbers</p>";
MakeTooltip("t_","lumiDef",tooltip);
tooltip="<p>SE's name or pattern, e.g. srm.cern.ch.</p>";
MakeTooltip("t_","seDef",tooltip);
#end if
#if $len($userInput)
SetCookie('DBSDD_ainput','$userInput')
#else
SetTagValue('DBSDD_ainput','userInput');
#end if
function UpdateCaseSens() {
  if(GetCookie('DBSDD_caseSensitive')=='off') {
     CaseSensitiveOff();
  } else {
     CaseSensitiveOn();
  }
}
UpdateCaseSens();
function UpdateUserView() {
   var grid=document.getElementById('grid');
   var url=window.location.href;
   if(url.search("grid=1")>0) {
      SetCookie('DBSDD_view','grid');
      grid.value=1;
   } else if(url.search("grid=0")>0) {
      SetCookie('DBSDD_view','list');
      grid.value=0;
   } else {
       var view=GetCookie('DBSDD_view');
       if (view) {
          if (view=='grid') {
              grid.value=1;
          } else {
              grid.value=0;
          }
       }  else {
          SetCookie('DBSDD_view','list');
          grid.value=0;
       }
   }
}
UpdateUserView();
function UpdateUserInput() {
   var input=GetCookie('DBSDD_ainput');
   if (input) {
      var id=document.getElementById('userInput');
      if (id) {
         id.value=input;
      }
   }
}
UpdateUserInput();
</script>
<p></p>

<!-- end of templateAdvancedSearchForm.tmpl -->
