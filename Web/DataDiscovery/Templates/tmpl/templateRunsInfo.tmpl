<!-- templateRunsInfo.tmpl -->
<script type="text/javascript">
registerAjaxPhedexCalls();
registerAjaxRunSummaryCalls();
</script>
#import urllib
#from DDUtil import sizeFormat, colorSizeHTMLFormat
####set nRun=len($runList)
#if $proc
<div>
Dataset:<br />
<table class="offset_left">
<tr>
<td align="left">
<b>$proc</b>
</td></tr></table>
contains $nRun run(s)
</div>
#end if
<p />
###<table id="$tableId" class="sortable" cellspacing="0" cellpadding="0" border="1">
<table id="$tableId" cellspacing="0" cellpadding="0" border="1">
<tr valign="top" align="center" id="tr$tableId" name="tr$tableId" class="sortable_gray">
<td>Run</td>
<td>Type</td>
<td>Events</td>
###<td>Lumi sec.</td>
###<td>Total L</td>
<td>Store</td>
<td>StartOfRun</td>
<td>EndOfRun</td>
<td>dataset</td>
<td># Files</td>
<td>Size</td>
#if $userMode=="runManager"
### here we took first item from runList and 11th element which is dsType 
#set first=$runList[0]
#set firstType=$first[11]
#if $len($runList) and $firstType.lower()!='mc'
<td>Mode</td>
<td>System</td>
#end if
#end if
#if $userMode=="expert"
<td>Created by</td>
<td>Creation time</td>
<td>Modified by</td>
<td>Modification time</td>
#end if
<td>LFNs</td>
<td>Transfer</td>
<td>Run Summary</td>
</tr>
###for dbsDict in $runList
#* (run,nEvts,nLumis,totLumi,store,sRun,eRun,cBy,cDate,mBy,mDate,dsType,path) *#
#set datasetDict={}
#set siteDict={}

#for item in $runList
#set run    = item[0]
#set nEvts  = item[1]
#set nLumis = item[2]
#set totLumi= item[3]
#set store  = item[4]
#set sRun   = item[5]
#set eRun   = item[6]
#set cBy    = item[7]
#set cDate  = item[8]
#set mBy    = item[9]
#set mDate  = item[10]
#set dsType = item[11]
#set procDS = item[12]
#set sites  = item[13]
#set fSize  = item[14]
#set nFiles = item[15]
<tr valign="top" bgcolor="#FFFADC" name="dbs_row_sumInfo" id="dbs_row_sumInfo">
### I need to get run type and decide do I need or not provide a link to run quality DB.
<td align="center">
#if $dsType.lower()!='mc'
<a href="http://cmsmon.cern.ch/cmsdb/servlet/RunSummary?RUN=$run">
$run
</a>
<a href="http://cmsmon.cern.ch/cmsdb/servlet/DQMBrowser?RUN=$run">
DQM
</a>
#else
$run
#end if
</td>
<td align="right">$dsType </td>
<td align="right">$nEvts </td>
###<td align="right">$nLumis </td>
###<td align="right">$totLumi </td>
<td align="right">$store </td>
<td align="right">$sRun </td>
<td align="right">$eRun </td>
<td>
<a href="$host/getData?dbsInst=$dbsInst&amp;proc=$urllib.quote($procDS)&amp;userMode=$userMode&amp;ajax=0&amp;phedex=off&amp;group=Any&amp;site=Any&amp;tier=Any&amp;app=Any&amp;primType=Any&amp;primD=Any">
#set pathName="/"+$procDS[1:].replace("/","<br />/")
$pathName
</a>
</td>
<td align="right">$nFiles</td>
<td align="right">$colorSizeHTMLFormat($fSize)</td>
#if $userMode=="runManager"
#if $dsType.lower()!='mc'
#if $runDBInfo.has_key($run)
#set runmode,system=$runDBInfo[$run]
#else
#set runmode='N/A'
#set system='N/A'
#end if
<td align="right">
$runmode
</td>
<td align="right">
$system
</td>
#end if
#end if
#if $userMode=="expert"
<td align="right">$cBy </td>
<td align="right">$cDate </td>
<td align="right">$mBy </td>
<td align="right">$mDate </td>
#end if
<td align="right">
<a href="$host/getLFN_txt?dbsInst=$dbsInst&amp;blockName=*&amp;dataset=$procDS&amp;userMode=$userMode&amp;run=$run&amp;what=cff">cff</a>
<a href="$host/getLFN_txt?dbsInst=$dbsInst&amp;blockName=*&amp;dataset=$procDS&amp;userMode=$userMode&amp;run=$run">plain</a>
<a href="$host/getLFNlist?dbsInst=$dbsInst&amp;blockName=*&amp;dataset=$procDS&amp;userMode=$userMode&amp;run=$run">details</a>
</td>
#### Here is Phedex transfer status call for each site
<td align="right">
#set phedexResponse="multiple:"+$procDS+":"+str($run)
#if $datasetDict.has_key($run)
#set datasetDict[$run]=$datasetDict[$run]+[$procDS]
#else
#set datasetDict[$run]=[$procDS]
#end if
#set siteDict[$run]=$sites
<div id="$phedexResponse">
<span class="hide">Phedex</span>
#for site in $sites
$site<br>
#end for
</div>

<script type="text/javascript">
var phedexUpdater = new PhedexUpdater('$phedexResponse');
ajaxEngine.registerAjaxObject('$phedexResponse',phedexUpdater);
</script>

</td>
#### Here is Run summary status call for each run
<td>
<div id="runSummary_key_$run" name="runSummary_key_$run"></div>
<div id="runSummary_triggers_$run" name="runSummary_triggers_$run"></div>
<div id="runSummary_events_$run" name="runSummary_events_$run"></div>
<div id="runSummary_bfield_$run" name="runSummary_bfield_$run"></div>
<div id="runSummary_components_$run" name="runSummary_components_$run"></div>
<script type="text/javascript">
var runUpdater_k = new RunSummaryUpdater('runSummary_key_$run');
ajaxEngine.registerAjaxObject('runSummary_key_$run',runUpdater_k);
var runUpdater_t = new RunSummaryUpdater('runSummary_triggers_$run');
ajaxEngine.registerAjaxObject('runSummary_triggers_$run',runUpdater_t);
var runUpdater_e = new RunSummaryUpdater('runSummary_events_$run');
ajaxEngine.registerAjaxObject('runSummary_events_$run',runUpdater_e);
var runUpdater_b = new RunSummaryUpdater('runSummary_bfield_$run');
ajaxEngine.registerAjaxObject('runSummary_bfield_$run',runUpdater_b);
var runUpdater_c = new RunSummaryUpdater('runSummary_components_$run');
ajaxEngine.registerAjaxObject('runSummary_components_$run',runUpdater_c);
</script>
</td>
</tr>
#end for
</table>
<hr class="dbs" />

<script type="text/javascript">
#set runs=""
#for run in $datasetDict.keys()
#set datasets=','.join($datasetDict[$run])
#set listOfSites=','.join($siteDict[$run])
ajaxPhedexStatus('$listOfSites','$datasets','$run');
#if not $runs
#set runs="%s"%$run
#else
#set runs=runs+',%s'%$run
#end if
#end for
ajaxRunSummary('$runs');
</script>
<!-- end of templateRunsInfo.tmpl -->
